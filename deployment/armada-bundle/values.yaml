# Default values for armada-bundle.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

dependencies:
  armada-server: true
  armada-executor: true
  armada-lookout: true
  armada-lookout-migration: true
  armada-lookout-ingester: true
  redis-ha: true
  stan: true
  pulsar: true
  executor-cluster-monitoring: true
  postgresql: true

redis-ha:
  fullnameOverride: redis-ha
  hardAntiAffinity: false
  persistentVolume:
    enabled: false

postgresql:
  fullnameOverride: postgresql
  auth:
    postgresPassword: psw

stan:
  stan:
    clusterID: "test-cluster"
  nameOverride: stan

kube-prometheus-stack:
  alertmanager:
    enabled: false

  prometheus:
    prometheusSpec:
      serviceMonitorSelectorNilUsesHelmValues: false
      ruleSelectorNilUsesHelmValues: false

  grafana:
    service:
      type: NodePort
      nodePort: 30001

  prometheusOperator:
    admissionWebhooks:
      enabled: false
    tls:
      enabled: false
    tlsProxy:
      enabled: false
    createCustomResource: false

armada:
  image:
    repository: gresearchdev/armada-server
    tag: v0.3.36
  ingressClass: nginx
  ingress:
    labels:
      kubernetes.io/ingress.class: nginx
  clusterIssuer: dev-ca
  hostnames: []

  applicationConfig:
    grpcPort: 50051
    httpPort: 8080
    auth:
      basicAuth:
        enableAuthentication: false
      anonymousAuth: true
      permissionGroupMapping:
        submit_jobs: [ "everyone" ]
        submit_any_jobs: [ "everyone" ]
        create_queue: [ "everyone" ]
        delete_queue: [ "everyone" ]
        cancel_jobs: [ "everyone" ]
        cancel_any_jobs: [ "everyone" ]
        reprioritize_jobs: [ "everyone" ]
        reprioritize_any_jobs: [ "everyone" ]
        watch_events: [ "everyone" ]
        watch_all_events: [ "everyone" ]
        execute_jobs: [ "everyone" ]
    redis:
      masterName: "mymaster"
      addrs:
        - "redis-ha-announce-0.armada.svc.cluster.local:26379"
        - "redis-ha-announce-1.armada.svc.cluster.local:26379"
        - "redis-ha-announce-2.armada.svc.cluster.local:26379"
    eventsRedis:
      masterName: "mymaster"
      addrs:
        - "redis-ha-announce-0.armada.svc.cluster.local:26379"
        - "redis-ha-announce-1.armada.svc.cluster.local:26379"
        - "redis-ha-announce-2.armada.svc.cluster.local:26379"
      poolSize: 1000
    eventsNats:
      timeout: 10s
      clusterId: "test-cluster"
      subject: "ArmadaTest"
      QueueGroup: "ArmadaEventRedisProcessor"
      servers:
        - "nats://stan.armada.svc.cluster.local:4222"
    pulsar:
      enabled: true
      URL: pulsar://pulsar-broker.armada.svc.cluster.local:6650
  prometheus:
    enabled: true

  nodePort: 30000

armada-executor:
  image:
    repository: gresearchdev/armada-executor
    tag: v0.3.36
  nodeSelector: nil
  applicationConfig:
    apiConnection:
      armadaUrl: armada.default.svc.cluster.local:50051
      ## Please note that this setting is insecure
      ## Do not use this setting in a production environment
      ## This should only be used for the quickstart and local testing
      forceNoTls: true
    kubernetes:
      minimumPodAge: 0s

  prometheus:
    enabled: true

executor-cluster-monitoring:
  additionalLabels:
    app: prometheus-operator
    release: prometheus-operator

  interval: 5s

armada-lookout:
  image:
    repository: gresearchdev/armada-lookout
    tag: v0.3.36
  ingressClass: nginx
  ingress:
    labels:
      kubernetes.io/ingress.class: nginx
  clusterIssuer: dev-ca
  hostnames: []

  prometheus:
    enabled: true

  applicationConfig:
    disableEventProcessing: true
    eventQueue: "ArmadaLookoutEventProcessor"
    nats:
      Servers:
        - "nats://stan.armada.svc.cluster.local:4222"
      ClusterID: "test-cluster"
      Subject: "ArmadaTest"
    postgres:
      connection:
        host: postgresql.armada.svc.cluster.local
        port: 5432
        user: postgres
        password: psw
        dbname: postgres

armada-lookout-migration:
  image:
    tag: v0.3.36
  ingressClass: nginx
  clusterIssuer: letsencrypt-dev

  prometheus:
    enabled: true

  applicationConfig:
    postgres:
      maxOpenConns: 100
      maxIdleConns: 25
      connMaxLifetime: 30m
      connection:
        host: postgresql.armada.svc.cluster.local
        port: 5432
        user: postgres
        password: psw
        dbname: postgres

armada-lookout-ingester:
  image:
    repository: gresearchdev/armada-lookout-ingester-dev
    tag: 88ea8f0b8124c7dbbb44f7c7315c0fca13655f18
  applicationConfig:
    postgres:
      maxOpenConns: 100
      maxIdleConns: 25
      connMaxLifetime: 30m
      connection:
        host: postgresql.armada.svc.cluster.local
        port: 5432
        user: postgres
        password: psw
        dbname: postgres
        sslmode: disable
    pulsar:
      enabled: true
      URL: "pulsar://pulsar-broker.armada.svc.cluster.local:6650"
      jobsetEventsTopic: "persistent://armada/armada/events"

pulsar:
  armadaInit:
    enabled: false
    image:
      repository: apachepulsar/pulsar
      tag: 2.10.2
    brokerHost: pulsar-broker.armada.svc.cluster.local
    protocol: http
    adminPort: 8080
    port: 6650
  proxy:
    service:
      type: ClusterIP
  grafana:
    service:
      type: ClusterIP
  initialize: true
  fullnameOverride: pulsar
