<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta charset="utf-8">

  <!-- Page Info -->
  <link rel="shortcut icon" href="/assets/img/Armada-favicon.png">
  <title>Developer setup – Armada Project</title>
  <meta name="description" content="">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title"
    content="Developer setup – Armada Project">
  <meta name="twitter:description" content="">
  <meta name="twitter:image:src" content="">

  <!-- Facebook OpenGraph -->
  <meta property="og:title"
    content="Developer setup – Armada Project" />
  <meta property="og:description" content="" />
  <meta property="og:image" content="" />

  <!--  Fonts and icons -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <!-- Nucleo Icons -->
  <link href="/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <link href="/assets/css/font-awesome.css" rel="stylesheet" />
  <link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link rel="stylesheet" href="/assets/styles/styles.css" rel="stylesheet">

  
  <!-- Analytics Code -->
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id= G-SKPDW30VNF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', ' G-SKPDW30VNF');
  </script>
  

  

</head>

<body>
  
    <nav id="navbar-main" class="navbar navbar-main navbar-expand-lg bg-default navbar-dark headroom">
      

        <div class="container">
          
          <a href="/" class="navbar-brand mr-lg-5">
            <img src="/assets/img/brand/Armada-white-rectangle.png">
          </a>
          

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_global"
            aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="navbar-collapse collapse" id="navbar_global">
            <div class="navbar-collapse-header">
              <div class="row">
                <div class="col-6 collapse-brand">
                  
                  <a href="/">
                    <img src="/assets/img/brand/Armada-dark-rectangle.png">
                  </a>
                  
                </div>
                <div class="col-6 collapse-close">
                  <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar_global"
                    aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation">
                    <span></span>
                    <span></span>
                  </button>
                </div>
              </div>
            </div>
            <ul class="navbar-nav navbar-nav-hover align-items-lg-center ml-lg-auto">
              
                
                  <li class="nav-item">
                    <a href="/design" class="nav-link">
                      <span class="nav-link-inner--text">Design</span>
                    </a>
                  </li>
                
              
                
                  <li class="nav-item dropdown">
                    <a href="javascript:;" class="nav-link" data-toggle="dropdown" role="button">
                      <span class="nav-link-inner--text">Documentation</span>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                      
                      <a class="dropdown-item" href="/developer">
                        <i class="ni "></i>
                        Development
                      </a>
                      
                      <a class="dropdown-item" href="/user">
                        <i class="ni "></i>
                        User Guide
                      </a>
                      
                      <a class="dropdown-item" href="/production-install">
                        <i class="ni "></i>
                        Production Install
                      </a>
                      
                    </div>
                  </li>
                
              
                
                  <li class="nav-item">
                    <a href="/quickstart" class="nav-link">
                      <span class="nav-link-inner--text">Quickstart</span>
                    </a>
                  </li>
                
              
                
                  <li class="nav-item">
                    <a href="/contribute" class="nav-link">
                      <span class="nav-link-inner--text">Contribute</span>
                    </a>
                  </li>
                
              
              <li class="nav-item github-logo-header desktop"><a class="" href="https://github.com/G-Research/armada" target="_blank">
                <img src="/assets/img/brand/GitHub-Mark-Light-120px-plus.png" width="40" height="40"></a>
              </li>
              <li class="nav-item mobile">
                <a href="https://github.com/G-Research/armada" class="nav-link" target="_blank">
                  <span class="nav-link-inner--text">Github</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
  <div class="wrapper page">
    
    <!-- Is not a blog post or blog archive or contact page -->
    <!-- Is a page with a banner -->
    <div class="page-header page-header-small header-filter mb-4">
      <div class="page-header-image card-background"
        style="background-image: url(/assets/img/ill/bg_contactus3.svg);"></div>
      <div class="container contentWrapper">
        <div class="row">
          <div class="col-lg-10 mx-auto text-center pt-4">
            <h2 class="display-2 text-white">Developer setup</h2>
            <h2 class="lead text-white pl-5 pr-5 pb-3 text-center"></h2>
          </div>
        </div>
      </div>
    </div>
    


    <div id="main" class="container">
      <h1 id="developer-setup">Developer setup</h1>

<h2 id="getting-started">Getting started</h2>

<p>There are many ways you can setup you local environment, this is just a basic quick example of how to setup everything you’ll need to get started running and developing Armada.</p>

<h3 id="pre-requisites">Pre-requisites</h3>
<p>To follow this section it is assumed you have:</p>
<ul>
  <li>Golang &gt;= 1.16 installed <a href="https://golang.org/doc/install">https://golang.org/doc/install</a></li>
  <li><code class="language-plaintext highlighter-rouge">kubectl</code> installed <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></li>
  <li>Docker installed, configured for the current user</li>
  <li>This repository cloned. The guide will assume you are in the root directory of this repository</li>
</ul>

<h3 id="running-armada-locally">Running Armada locally</h3>

<p>There are two options for developing Armada locally.</p>

<h5 id="kind">Kind</h5>
<p>You can use a <a href="https://github.com/kubernetes-sigs/kind">kind</a> Kubernetes clusters.</p>
<ul>
  <li>The advantage of this is it is more like a real kubernetes cluster</li>
  <li>However it is a bit more effort to set it up and it can only emulate a cluster with as much resource as your computer has</li>
</ul>

<p>This is recommended if load doesn’t matter or you are working on features that rely on integrating with kubernetes functionality</p>

<h5 id="fake-executor">Fake-executor</h5>
<p>You can use fake-executor</p>

<ul>
  <li>It is easy to setup, as it is just a Go program that emulates a kubernetes cluster</li>
  <li>It allows you emulate clusters much larger than your current machine</li>
  <li>As the jobs aren’t really running, it won’t properly emulate a real kubernetes cluster</li>
</ul>

<p>This is recommended when working on features that are purely Armada specific or if you want to get a high load of jobs running through Armada components</p>

<h4 id="setup-kind-development">Setup Kind development</h4>

<ol>
  <li>Get kind (Installation help <a href="https://kind.sigs.k8s.io/docs/user/quick-start/">here</a>)
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">GO111MODULE</span><span class="o">=</span><span class="s2">"on"</span> go get sigs.k8s.io/kind@v0.11.1
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create kind clusters (you can create any number of clusters)</p>

    <p>As this step is using Docker, it may require root to run</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> kind create cluster <span class="nt">--name</span> demo-a <span class="nt">--config</span> ./example/kind-config.yaml
 kind create cluster <span class="nt">--name</span> demo-b <span class="nt">--config</span> ./example/kind-config.yaml
</code></pre></div>    </div>
  </li>
  <li>Start Redis
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker run <span class="nt">-d</span> <span class="nt">-p</span> 6379:6379 redis
</code></pre></div>    </div>

    <p>The following steps are shown in a terminal, but for development is it recommended they are run in your IDE</p>
  </li>
  <li>Start server in one terminal
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> go run ./cmd/armada/main.go <span class="nt">--config</span> ./e2e/setup/insecure-armada-auth-config.yaml
</code></pre></div>    </div>
  </li>
  <li>Start executor for demo-a in a new terminal
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">ARMADA_APPLICATION_CLUSTERID</span><span class="o">=</span>kind-demo-a <span class="nv">ARMADA_METRIC_PORT</span><span class="o">=</span>9001 go run ./cmd/executor/main.go
</code></pre></div>    </div>
  </li>
  <li>Start executor for demo-b in a new terminal
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">ARMADA_APPLICATION_CLUSTERID</span><span class="o">=</span>kind-demo-b <span class="nv">ARMADA_METRIC_PORT</span><span class="o">=</span>9002 go run ./cmd/executor/main.go
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="setup-fake-executor-development">Setup Fake-executor development</h4>

<ol>
  <li>Start Redis
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker run <span class="nt">-d</span> <span class="nt">-p</span> 6379:6379 redis
</code></pre></div>    </div>

    <p>The following steps are shown in a terminal, but for development is it recommended they are run in your IDE</p>
  </li>
  <li>Start server in one terminal
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> go run ./cmd/armada/main.go <span class="nt">--config</span> ./e2e/setup/insecure-armada-auth-config.yaml
</code></pre></div>    </div>
  </li>
  <li>Start executor for demo-a in a new terminal
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">ARMADA_APPLICATION_CLUSTERID</span><span class="o">=</span>demo-a <span class="nv">ARMADA_METRIC_PORT</span><span class="o">=</span>9001 go run ./cmd/fakeexecutor/main.go
</code></pre></div>    </div>
  </li>
  <li>Start executor for demo-b in a new terminal
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">ARMADA_APPLICATION_CLUSTERID</span><span class="o">=</span>demo-b <span class="nv">ARMADA_METRIC_PORT</span><span class="o">=</span>9002 go run ./cmd/fakeexecutor/main.go
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="optional-components">Optional components</h4>

<h5 id="nats-streaming">NATS Streaming</h5>
<p>Armada can be set up to use NATS Streaming as message queue for events.
To run NATS Streaming for development you can use docker:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 4223:4223 <span class="nt">-p</span> 8223:8223 nats-streaming <span class="nt">-p</span> 4223 <span class="nt">-m</span> 8223
</code></pre></div></div>

<p>For armada configuration check end to end test setup:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go run ./cmd/armada/main.go <span class="nt">--config</span> ./e2e/setup/insecure-armada-auth-config.yaml <span class="nt">--config</span> ./e2e/setup/nats/armada-config.yaml
</code></pre></div></div>

<h5 id="lookout---armada-ui">Lookout - Armada UI</h5>
<p>Lookout requires Armada to be configured with NATS Streaming.
To run Lookout, firstly build frontend:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ./internal/lookout/ui
npm <span class="nb">install
</span>npm run openapi
npm run build
</code></pre></div></div>
<p>Start a Postgres database:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 5432:5432 <span class="nt">-e</span> <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>psw postgres
</code></pre></div></div>
<p>Migrate database:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go run ./cmd/lookout/main.go <span class="nt">--migrateDatabase</span>
</code></pre></div></div>
<p>Then run go application:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go run ./cmd/lookout/main.go 
</code></pre></div></div>
<p>For UI development you can also use the React development server.
Note that the Lookout API will still have to be running for this to work.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run start
</code></pre></div></div>

<h4 id="quick-dev-setup">Quick dev setup</h4>

<p>Optionally, you can get a <code class="language-plaintext highlighter-rouge">kind</code> cluster and redis, NATS and PostgreSQL containers up by running</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./docs/dev/setup.sh
</code></pre></div></div>
<p>The script will print out commands to execute each of the three Armada components, <code class="language-plaintext highlighter-rouge">armada</code>, <code class="language-plaintext highlighter-rouge">armada-lookout</code>, and <code class="language-plaintext highlighter-rouge">armada-executor</code>.</p>

<p>If you want to run Armada components using NATS Jetstream (as opposed to NATS streaming), you can run and copy the commands from the following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./docs/dev/setup.sh jetstream
</code></pre></div></div>

<p>When you’re done, you can run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./docs/dev/teardown.sh
</code></pre></div></div>
<p>to tear down your development environment.</p>

<h4 id="testing-your-setup">Testing your setup</h4>

<ol>
  <li>Create queue &amp; Submit job
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go run ./cmd/armadactl/main.go create queue <span class="nb">test</span> <span class="nt">--priorityFactor</span> 1
go run ./cmd/armadactl/main.go submit ./example/jobs.yaml
go run ./cmd/armadactl/main.go watch <span class="nb">test </span>job-set-1
</code></pre></div>    </div>
  </li>
</ol>

<p>For more details on submitting jobs to Armada, see <a href="https://github.com/G-Research/armada/blob/master/docs/user.md">here</a>.</p>

<p>Once you submit jobs, you should be able to see pods appearing in your cluster(s), running what you submitted.</p>

<p><strong>Note:</strong> Depending on your Docker setup you might need to load images for jobs you plan to run manually:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kind load docker-image busybox:latest
</code></pre></div></div>

<h3 id="running-tests">Running tests</h3>
<p>For unit tests run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make tests
</code></pre></div></div>

<p>For end to end tests run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make tests-e2e
<span class="c"># optionally stop kubernetes cluster which was started by test</span>
make e2e-stop-cluster
</code></pre></div></div>

<h2 id="code-generation">Code Generation</h2>

<p>This project uses code generation.</p>

<p>The armada api is defined using proto files which are used to generate Go source code (and the c# client) for our gRPC communication.</p>

<p>To generate source code from proto files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make proto
</code></pre></div></div>

<h3 id="usage-metrics">Usage metrics</h3>

<p>Some functionality the executor has is to report how much cpu/memory jobs are actually using.</p>

<p>This is turned on by changing the executor config file to include:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metric</span><span class="pi">:</span>
   <span class="na">exposeQueueUsageMetrics</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>The metrics are calculated by getting values from metrics-server.</p>

<p>When developing locally with Kind, you will also need to deploy metrics server to allow this to work.</p>

<p>The simplest way to do this it to apply this to your kind cluster:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f https://gist.githubusercontent.com/hjacobs/69b6844ba8442fcbc2007da316499eb4/raw/5b8678ac5e11d6be45aa98ca40d17da70dcb974f/kind-metrics-server.yaml
</code></pre></div></div>

<h3 id="command-line-tools">Command-line tools</h3>

<p>Our command-line tools used the cobra framework <a href="https://github.com/spf13/cobra">https://github.com/spf13/cobra</a>.</p>

<p>You can use the cobra cli to add new commands, the below will describe how to add new commands for <code class="language-plaintext highlighter-rouge">armadactl</code> but it can be applied to any of our command line tools.</p>

<h5 id="steps">Steps</h5>

<p>Get cobra cli tool:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go get -u github.com/spf13/cobra/cobra
</code></pre></div></div>

<p>Change to the directory of the command-line tool you are working on:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ./cmd/armadactl
</code></pre></div></div>

<p>Use cobra to add new command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cobra add commandName
</code></pre></div></div>

<p>You should see a new file appear under <code class="language-plaintext highlighter-rouge">./cmd/armadactl/cmd</code> with the name you specified in the command.</p>

    </div>
  </div>


  <footer class="footer mt-5 pt-4">
  <div class="container">
    <div class="row row-grid align-items-center mb-2 mt-2">
      <div class="col-lg-6">
        <h4 class="mb-0 font-weight-light">Armada Project</h4>
      </div>
      <div class="col-lg-6 text-lg-right">
        
    

    
    <button onclick="location.href='https://github.com/G-Research/armada/discussions';" rel="nofollow" class="btn btn-icon-only btn-discussions rounded-circle" data-toggle="tooltip" data-original-title="Discussions">
        <span class="btn-inner--icon">
            <i class="fab fa-discussions" aria-hidden="true"></i>
        </span>
    </button>
    

    
    <button onclick="location.href='https://twitter.com/GRESEARCHjobs';" rel="nofollow" class="btn btn-icon-only btn-twitter rounded-circle" data-toggle="tooltip" data-original-title="Twitter">
        <span class="btn-inner--icon">
            <i class="fab fa-twitter" aria-hidden="true"></i>
        </span>
    </button>
    

    

    

    

    

    

    

    

    
    <button onclick="location.href='https://github.com/G-Research/armada';" rel="nofollow" class="btn btn-icon-only btn-github rounded-circle" data-toggle="tooltip" data-original-title="Github">
        <span class="btn-inner--icon">
            <i class="fab fa-github" aria-hidden="true"></i>
        </span>
    </button>
    

    

    

      </div>
    </div>
    <hr>
    <div class="row align-items-center justify-content-md-between">
      <div class="col-md-6">
        <div class="copyright">
          <span> © 2022 Armada Project</span>
        </div>
      </div>
      <div class="col-md-6">
        <ul class="nav nav-footer justify-content-end">
          
          
          <li class="nav-item">
            <a href="/design" class="nav-link">
              <span class="nav-link-inner--text">Design</span>
            </a>
          </li>
          
          
          
          <li class="nav-item">
            <a href="" class="nav-link">
              <span class="nav-link-inner--text">Documentation</span>
            </a>
          </li>

          
          
          
          <li class="nav-item">
            <a href="/quickstart" class="nav-link">
              <span class="nav-link-inner--text">Quickstart</span>
            </a>
          </li>
          
          
          
          <li class="nav-item">
            <a href="/contribute" class="nav-link">
              <span class="nav-link-inner--text">Contribute</span>
            </a>
          </li>
          
          
        </ul>
      </div>
    </div>
  </div>
</footer>



<!--   Core JS Files   -->
<script src="/assets/js/core/jquery.min.js" type="text/javascript"></script>
<script src="/assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<script src="/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="/assets/js/plugins/bootstrap-switch.js"></script>
<!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
<script src="/assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
<!--  Plugin for the Carousel, full documentation here: http://jedrzejchalubek.com/ -->
<script src="/assets/js/plugins/glide.js" type="text/javascript"></script>
<!--  Plugin for the DatePicker, full documentation here: https://flatpickr.js.org/ -->
<script src="/assets/js/plugins/moment.min.js"></script>
<!--	Plugin for Select, full documentation here: https://joshuajohnson.co.uk/Choices/ -->
<script src="/assets/js/plugins/choices.min.js" type="text/javascript"></script>
<!--  Plugin for the DateTimePicker, full documentation here: https://flatpickr.js.org/ -->
<script src="/assets/js/plugins/datetimepicker.js" type="text/javascript"></script>
<!-- Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
<script src="/assets/js/plugins/jasny-bootstrap.min.js"></script>
<!-- Plugin for Headrom, full documentation here: https://wicky.nillia.ms/headroom.js/ -->
<script src="/assets/js/plugins/headroom.min.js"></script>
<!-- Control Center for Argon UI Kit: parallax effects, scripts for the example pages etc -->

<script>
  // Blog Post Carousel
  if (document.querySelector('.blogGlide') !== null) {
    new Glide('.blogGlide', {
      type: 'carousel',
      startAt: 0,
      focusAt: 2,
      perTouch: 1,
      perView: 4
    }).mount();
  }

  if (document.querySelector('.glide') !== null) {
    // Generic
     new Glide('.glide', {
      type: 'carousel',
      startAt: 0,
      focusAt: 2,
      perTouch: 1,
      perView: 4
    }).mount();
  }

  if (document.querySelector('.testimonial-glide') !== null) {
    // Testimonial Carousel
    new Glide('.testimonial-glide', {
      type: 'carousel',
      startAt: 0,
      focusAt: 2,
      perTouch: 1,
      perView: 4
    }).mount();
  }

</script>

<script>
  $(function () {
    var navOffset = $('#navbar-main').height();
    $('.contentWrapper').css('padding-top', navOffset * 2 + 'px');
  });    
</script>



<script src="/assets/js/argon-design-system.min.js?v=1.0.0" type="text/javascript"></script>

  

</body>

</html>
</body>

</html>
